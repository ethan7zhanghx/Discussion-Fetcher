# Selenium + Cookies æ–¹æ¡ˆè¯´æ˜

## ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ

### âŒ å…¶ä»–æ–¹æ¡ˆçš„é—®é¢˜

| æ–¹æ¡ˆ | é—®é¢˜ |
|------|------|
| **æ‰‹åŠ¨ä¿å­˜ HTML** | âŒ éœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œå®Œå…¨ä¸è‡ªåŠ¨åŒ– |
| **requests + HTML** | âŒ åªèƒ½è·å–ç¬¬ä¸€é¡µï¼ˆ~25æ¡è¯„è®ºï¼‰ |
| **Reddit JSON API** | âŒ è¢«é˜»æ­¢ï¼ˆ403é”™è¯¯ï¼‰ï¼Œéœ€è¦ OAuth è®¤è¯ |

### âœ… Selenium + Cookies æ–¹æ¡ˆçš„ä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å®Œå…¨è‡ªåŠ¨åŒ–** | âœ… æ— éœ€æ‰‹åŠ¨æ“ä½œ |
| **å®Œæ•´æ•°æ®** | âœ… æ»šåŠ¨åŠ è½½æ‰€æœ‰è¯„è®ºï¼ˆå‡ ç™¾æ¡/æ¿å—ï¼‰ |
| **é¿å…éªŒè¯** | âœ… ä½¿ç”¨ cookies é¿å… CAPTCHA |
| **é¿å…é™æµ** | âœ… å·²ç™»å½•ç”¨æˆ·é™åˆ¶æ›´å°‘ |
| **æ•ˆæœç­‰åŒ** | âœ… ä¸æ‰‹åŠ¨ä¿å­˜ HTML æ•ˆæœç›¸åŒ |

---

## Cookies çš„ä½œç”¨

### 1. é¿å… CAPTCHA éªŒè¯

**æ—  Cookiesï¼š**
```
âŒ "Prove your humanity" å¼¹çª—
âŒ éœ€è¦æ‰‹åŠ¨ç‚¹å‡»éªŒè¯
```

**æœ‰ Cookiesï¼š**
```
âœ… ç›´æ¥è®¿é—®ï¼Œæ— éªŒè¯
âœ… å®Œå…¨è‡ªåŠ¨åŒ–
```

### 2. é¿å…ç™»å½•å¼¹çª—

**æ—  Cookiesï¼š**
```
âŒ "Log in to continue" å¼¹çª—
âŒ éƒ¨åˆ†å†…å®¹ä¸å¯è§
```

**æœ‰ Cookiesï¼š**
```
âœ… å·²ç™»å½•çŠ¶æ€
âœ… æŸ¥çœ‹å®Œæ•´å†…å®¹
```

### 3. é¿å…é™æµ

**æ—  Cookiesï¼š**
```
âŒ "whoa there, pardner" é”™è¯¯
âŒ è¯·æ±‚è¢«é™åˆ¶
```

**æœ‰ Cookiesï¼š**
```
âœ… å·²ç™»å½•ç”¨æˆ·é™åˆ¶æ›´å°‘
âœ… ç¨³å®šè®¿é—®
```

---

## å¦‚ä½•å¯¼å‡º Cookiesï¼Ÿ

### æ–¹æ³• 1: EditThisCookie æ’ä»¶ï¼ˆæ¨èï¼‰

1. **å®‰è£…æ’ä»¶**
   - Chrome/Edge: https://chrome.google.com/webstore â†’ æœç´¢ "EditThisCookie"
   - Firefox: https://addons.mozilla.org â†’ æœç´¢ "EditThisCookie"

2. **ç™»å½• Reddit**
   - è®¿é—® https://www.reddit.com
   - ç™»å½•ä½ çš„è´¦å·

3. **å¯¼å‡º Cookies**
   - ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ çš„ EditThisCookie å›¾æ ‡
   - ç‚¹å‡» "Export" æŒ‰é’®ï¼ˆğŸ“¤ å›¾æ ‡ï¼‰
   - å¤åˆ¶ JSON å†…å®¹
   - ä¿å­˜ä¸º `./cookies.json`

### æ–¹æ³• 2: æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. ç™»å½• Reddit
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° "Application" / "å­˜å‚¨" æ ‡ç­¾
4. å·¦ä¾§é€‰æ‹© "Cookies" â†’ "https://www.reddit.com"
5. å¤åˆ¶é‡è¦ cookies çš„åç§°å’Œå€¼
6. æŒ‰ç…§ `cookies.example.json` æ ¼å¼åˆ›å»º `cookies.json`

---

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```bash
# 1. å¯¼å‡º cookiesï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
# æŒ‰ç…§ä¸Šè¿°æ­¥éª¤å¯¼å‡ºå¹¶ä¿å­˜ä¸º cookies.json

# 2. å®‰è£…ä¾èµ–ï¼ˆåŒ…æ‹¬ Seleniumï¼‰
pip install -r requirements.txt

# 3. è¿è¡ŒæŠ“å–ï¼ˆè‡ªåŠ¨è·å– Posts + Commentsï¼‰
python3 fetch_all.py --reddit-comments
```

### é«˜çº§é…ç½®

```python
from src.reddit_comments_selenium import RedditCommentsSeleniumFetcher

# åˆ›å»º fetcher
fetcher = RedditCommentsSeleniumFetcher(
    cookies_file='./cookies.json',
    headless=True,       # æ— å¤´æ¨¡å¼ï¼ˆä¸æ˜¾ç¤ºæµè§ˆå™¨ï¼‰
    verbose=True,        # è¯¦ç»†æ—¥å¿—
    max_scrolls=10       # æ¯ä¸ªæ¿å—æ»šåŠ¨10æ¬¡ï¼ˆçº¦200-300æ¡è¯„è®ºï¼‰
)

# è·å–è¯„è®º
comments = fetcher.fetch(
    query='ERNIE',
    subreddits=['LocalLLM', 'ChatGPT'],  # æŒ‡å®šæ¿å—
    sort='relevance',
    time_filter='all',
    max_scrolls=10
)

print(f"è·å– {len(comments)} æ¡è¯„è®º")
```

### æµ‹è¯•å•ä¸ªæ¿å—

```bash
# æµ‹è¯•å•ä¸ªæ¿å—ï¼ˆæ˜¾ç¤ºæµè§ˆå™¨çª—å£ï¼‰
python3 -c "from src.reddit_comments_selenium import RedditCommentsSeleniumFetcher; \
            f = RedditCommentsSeleniumFetcher(headless=False, verbose=True); \
            f.fetch(subreddits=['LocalLLM'], max_scrolls=5)"
```

---

## å·¥ä½œåŸç†

### æµç¨‹å›¾

```
1. å¯åŠ¨ Chromeï¼ˆæ— å¤´æ¨¡å¼ï¼‰
   â†“
2. åŠ è½½ cookiesï¼ˆé¿å…ç™»å½•/éªŒè¯ï¼‰
   â†“
3. è®¿é—®æœç´¢é¡µé¢
   â†“
4. æ»šåŠ¨åŠ è½½æ›´å¤šå†…å®¹ï¼ˆé‡å¤ N æ¬¡ï¼‰
   â”œâ”€ æ»šåŠ¨åˆ°åº•éƒ¨
   â”œâ”€ ç­‰å¾…æ–°å†…å®¹åŠ è½½
   â”œâ”€ æ£€æŸ¥é¡µé¢é«˜åº¦å˜åŒ–
   â””â”€ ç»§ç»­æ»šåŠ¨æˆ–åœæ­¢
   â†“
5. è·å–å®Œæ•´ HTML
   â†“
6. è§£æè¯„è®ºæ•°æ®
   â†“
7. ä¿å­˜åˆ°æ•°æ®åº“
```

### å…³é”®æŠ€æœ¯

**Selenium WebDriver:**
- è‡ªåŠ¨æ§åˆ¶ Chrome æµè§ˆå™¨
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º
- æ‰§è¡Œ JavaScriptï¼ˆæ»šåŠ¨ã€ç‚¹å‡»ç­‰ï¼‰

**Cookie ç®¡ç†:**
```python
# åŠ è½½ cookies åˆ°æµè§ˆå™¨
driver.get("https://www.reddit.com")  # å…ˆè®¿é—®åŸŸå
driver.add_cookie({
    'name': 'reddit_session',
    'value': 'your_value',
    'domain': '.reddit.com'
})
driver.refresh()  # åˆ·æ–°ä»¥åº”ç”¨ cookies
```

**æ»šåŠ¨åŠ è½½:**
```javascript
// æ»šåŠ¨åˆ°åº•éƒ¨
window.scrollTo(0, document.body.scrollHeight);

// æ£€æµ‹é¡µé¢é«˜åº¦
document.body.scrollHeight
```

---

## æ€§èƒ½å¯¹æ¯”

### æ•°æ®é‡å¯¹æ¯”

| æ–¹æ¡ˆ | è¯„è®ºæ•°/æ¿å— | æ€»è¯„è®ºæ•°ï¼ˆ9ä¸ªæ¿å—ï¼‰ |
|------|------------|-------------------|
| **requests + HTML** | ~25 æ¡ | ~225 æ¡ |
| **Seleniumï¼ˆæ»šåŠ¨5æ¬¡ï¼‰** | ~100-150 æ¡ | ~900-1350 æ¡ |
| **Seleniumï¼ˆæ»šåŠ¨10æ¬¡ï¼‰** | ~200-300 æ¡ | ~1800-2700 æ¡ |
| **æ‰‹åŠ¨ä¿å­˜ HTML** | ~200-500 æ¡ | ~1800-4500 æ¡ |

### é€Ÿåº¦å¯¹æ¯”

| æ–¹æ¡ˆ | è€—æ—¶ï¼ˆ9ä¸ªæ¿å—ï¼‰ |
|------|----------------|
| **requests + HTML** | ~30 ç§’ |
| **Seleniumï¼ˆæ»šåŠ¨5æ¬¡ï¼‰** | ~3-5 åˆ†é’Ÿ |
| **Seleniumï¼ˆæ»šåŠ¨10æ¬¡ï¼‰** | ~5-10 åˆ†é’Ÿ |
| **æ‰‹åŠ¨ä¿å­˜ HTML** | ~10-20 åˆ†é’Ÿï¼ˆæ‰‹åŠ¨æ“ä½œï¼‰ |

---

## å¸¸è§é—®é¢˜

### Q: éœ€è¦å®‰è£… Chrome å—ï¼Ÿ

A: æ˜¯çš„ï¼ŒSelenium éœ€è¦ Chrome æµè§ˆå™¨ã€‚è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½ ChromeDriverã€‚

### Q: Cookies ä¼šè¿‡æœŸå—ï¼Ÿ

A: ä¼šçš„ã€‚å¦‚æœé‡åˆ°ç™»å½•å¼¹çª—æˆ– CAPTCHAï¼Œé‡æ–°å¯¼å‡º cookies å³å¯ã€‚

### Q: å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå—ï¼Ÿ

A: å¯ä»¥ï¼Œä½†éœ€è¦å®‰è£…ï¼š
```bash
# Ubuntu/Debian
sudo apt-get install chromium-browser chromium-chromedriver

# ä½¿ç”¨æ— å¤´æ¨¡å¼
headless=True
```

### Q: æ»šåŠ¨æ¬¡æ•°è®¾ç½®å¤šå°‘åˆé€‚ï¼Ÿ

A: å»ºè®®ï¼š
- **å¿«é€Ÿæµ‹è¯•**ï¼š5 æ¬¡ï¼ˆ~100æ¡/æ¿å—ï¼‰
- **å¸¸è§„ä½¿ç”¨**ï¼š10 æ¬¡ï¼ˆ~200æ¡/æ¿å—ï¼‰
- **å®Œæ•´æ•°æ®**ï¼š20 æ¬¡ï¼ˆ~400æ¡/æ¿å—ï¼‰

### Q: ä¼šè¢« Reddit å°ç¦å—ï¼Ÿ

A: ä½¿ç”¨ cookies + åˆç†çš„é€Ÿç‡é™åˆ¶ï¼ˆ2-3ç§’/è¯·æ±‚ï¼‰ï¼Œé£é™©å¾ˆä½ã€‚

### Q: æ— å¤´æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ

A: æµè§ˆå™¨åœ¨åå°è¿è¡Œï¼Œä¸æ˜¾ç¤ºçª—å£ã€‚è®¾ç½® `headless=False` å¯ä»¥çœ‹åˆ°æµè§ˆå™¨çª—å£ï¼ˆè°ƒè¯•æ—¶æœ‰ç”¨ï¼‰ã€‚

---

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šChromeDriver ä¸‹è½½å¤±è´¥

```bash
# æ‰‹åŠ¨å®‰è£…
pip install webdriver-manager --upgrade

# æˆ–æŒ‡å®š ChromeDriver è·¯å¾„
from selenium.webdriver.chrome.service import Service
service = Service('/path/to/chromedriver')
```

### é—®é¢˜ï¼šCookies åŠ è½½å¤±è´¥

æ£€æŸ¥ cookies.json æ ¼å¼ï¼š
```json
[
  {
    "name": "reddit_session",
    "value": "your_value",
    "domain": ".reddit.com"
  }
]
```

### é—®é¢˜ï¼šæ»šåŠ¨ä¸åŠ è½½æ–°å†…å®¹

å¯èƒ½åŸå› ï¼š
1. å·²åˆ°åº•éƒ¨ï¼ˆæ²¡æœ‰æ›´å¤šå†…å®¹ï¼‰
2. ç½‘ç»œæ…¢ï¼ˆå¢åŠ ç­‰å¾…æ—¶é—´ï¼‰
3. é¡µé¢ç»“æ„å˜åŒ–ï¼ˆæ›´æ–°è§£æä»£ç ï¼‰

---

## æ€»ç»“

**Selenium + Cookies æ–¹æ¡ˆæ˜¯ç›®å‰æœ€ä½³é€‰æ‹©ï¼š**

âœ… **å®Œå…¨è‡ªåŠ¨åŒ–** - æ— éœ€æ‰‹åŠ¨æ“ä½œ
âœ… **æ•°æ®å®Œæ•´** - è·å–å‡ ç™¾æ¡è¯„è®º/æ¿å—
âœ… **ç¨³å®šå¯é ** - ä½¿ç”¨ cookies é¿å…é™åˆ¶
âœ… **æ•ˆæœç­‰åŒ** - ä¸æ‰‹åŠ¨ä¿å­˜ HTML æ•ˆæœç›¸åŒ

**å”¯ä¸€ç¼ºç‚¹ï¼š**
- éœ€è¦ Chrome æµè§ˆå™¨
- é€Ÿåº¦æ¯”çº¯ API æ…¢ï¼ˆä½†èƒ½è·å–æ›´å¤šæ•°æ®ï¼‰

**æ¨èé…ç½®ï¼š**
```bash
python3 fetch_all.py --reddit-comments --max-pages=10
```

è¿™æ ·å¯ä»¥åœ¨åˆç†æ—¶é—´å†…ï¼ˆ~10åˆ†é’Ÿï¼‰è·å–å®Œæ•´æ•°æ®ï¼ˆ~2000æ¡è¯„è®ºï¼‰ã€‚
